-- CREATE TABLE book
-- (
--     book_id serial PRIMARY KEY,
--     title varchar(50) NOT NULL,
--     author varchar(50) NOT NULL
-- );
-- INSERT INTO book(title, author)
-- VALUES ('Alice in Wonderland', 'Lewis Carroll'), 
-- ('Harry Potter', 'J.K. Rowling'),
-- ('To Kill a Mockingbird', 'Harper Lee');
-- select * from book;
-- CREATE TABLE student
-- (
-- 	student_id SERIAL PRIMARY KEY,
-- 	name varchar(50) NOT NULL UNIQUE,
-- 	age INT,
-- 	CHECK(age <= 15)
-- );
-- INSERT INTO student (name, age)
-- VALUES ('John', 12),
-- ('Lera', 11),
-- ('Patrick', 10),
-- ('Bob', 14);
-- select * from student;
-- DROP TABLE IF EXISTS library;
-- CREATE TABLE library (
-- 	book_fk_id INT,
-- 	student_fk_id INT,
-- 	borrowed_date DATE,
-- 	FOREIGN KEY(book_fk_id) references book(book_id) ON DELETE CASCADE ON UPDATE CASCADE,
-- 	FOREIGN KEY(student_fk_id) references student(student_id) ON DELETE CASCADE ON UPDATE CASCADE,
-- 	PRIMARY KEY (book_fk_id, student_fk_id)
-- );
-- select * from library;
-- INSERT INTO library (book_fk_id, student_fk_id, borrowed_date)
-- SELECT b.book_id, s.student_id, date('15/02/2022')
-- from book b, student s
-- where b.title = 'Alice in Wonderland' and s.name = 'John'
-- UNION ALL
-- SELECT b.book_id, s.student_id, date('03/03/2021')
-- from book b, student s
-- where b.title = 'To Kill a Mockingbird' and s.name = 'Bob'
-- UNION ALL
-- SELECT b.book_id, s.student_id, date('23/05/2021')
-- from book b, student s
-- where b.title = 'Alice in Wonderland' and s.name = 'Lera'
-- UNION ALL
-- SELECT b.book_id, s.student_id, date('12/08/2021')
-- from book b, student s
-- where b.title = 'Harry Potter' and s.name = 'Bob';

-- Select all the columns from the junction table
-- select * from library;

-- Select the name of the student and the title of the borrowed books
-- select student.name, book.title
-- from library
-- inner join student on library.student_fk_id = student.student_id
-- inner join book on library.book_fk_id = book.book_id;

-- Select the average age of the children, that borrowed the book Alice in Wonderland
-- select avg(student.age)
-- from library
-- inner join student on library.student_fk_id = student.student_id
-- inner join book on library.book_fk_id = book.book_id;

-- Delete a student from the Student table, what happened in the junction table ?
-- One the corresponding records in library are also removed.
-- select * from library; --gives 4 records, starting with student_fk_id = 1,
-- Delete from student where student_id = 1;
-- select * from library;  -- gives 3 records